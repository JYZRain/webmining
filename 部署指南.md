# 桌游方舟推荐系统 - 部署指南

本指南将帮助您将桌游推荐系统部署到各个云平台，让所有用户都能直接访问。

## 📋 部署前准备

### 1. 确认文件结构
```
webmining/
├── app.py              # 主应用文件
├── enhanced_recommendation.py  # 推荐系统
├── requirements.txt    # 依赖包
├── Procfile           # 部署配置
├── data/
│   └── BGG_Data.csv   # 数据文件
├── static/            # 静态文件
├── templates/         # 模板文件
└── instance/          # 数据库文件
```

### 2. 环境变量配置
在部署时，您需要设置以下环境变量：
- `SECRET_KEY`: Flask应用的密钥（建议使用随机字符串）
- `FLASK_ENV`: 设置为 `production`

## 🚀 部署选项

### 选项1：Heroku（推荐）

**优点：** 免费额度、易于部署、自动SSL、自定义域名支持
**缺点：** 应用会在30分钟无访问后休眠

#### 部署步骤：

1. **安装Heroku CLI**
   ```bash
   # macOS
   brew install heroku/brew/heroku
   
   # Windows
   # 下载并安装 https://devcenter.heroku.com/articles/heroku-cli
   ```

2. **登录Heroku**
   ```bash
   heroku login
   ```

3. **创建Heroku应用**
   ```bash
   cd webmining
   heroku create your-app-name
   ```

4. **配置环境变量**
   ```bash
   heroku config:set SECRET_KEY="your-secret-key-here"
   heroku config:set FLASK_ENV=production
   ```

5. **部署应用**
   ```bash
   git init
   git add .
   git commit -m "Initial commit"
   git push heroku main
   ```

6. **访问应用**
   ```bash
   heroku open
   ```

### 选项2：Railway

**优点：** 更快的启动时间、更好的免费额度、GitHub集成
**缺点：** 相对较新的平台

#### 部署步骤：

1. **访问Railway**
   - 前往 https://railway.app/
   - 使用GitHub账号登录

2. **创建新项目**
   - 点击 "New Project"
   - 选择 "Deploy from GitHub repo"
   - 选择包含webmining文件夹的仓库

3. **配置环境变量**
   - 在项目设置中添加：
     - `SECRET_KEY`: 您的密钥
     - `FLASK_ENV`: `production`

4. **配置构建设置**
   - Root Directory: `webmining`
   - Start Command: `gunicorn app:app`

### 选项3：Render

**优点：** 免费SSL、自定义域名、自动部署
**缺点：** 构建时间较长

#### 部署步骤：

1. **访问Render**
   - 前往 https://render.com/
   - 注册账号

2. **创建Web Service**
   - 点击 "New +" → "Web Service"
   - 连接GitHub仓库

3. **配置服务**
   - Name: `boardgame-ark`
   - Environment: `Python 3`
   - Build Command: `pip install -r requirements.txt`
   - Start Command: `gunicorn app:app`
   - Root Directory: `webmining`

4. **添加环境变量**
   - `SECRET_KEY`: 您的密钥
   - `FLASK_ENV`: `production`

### 选项4：PythonAnywhere

**优点：** 专为Python设计、简单易用、免费额度充足
**缺点：** 自定义域名需要付费

#### 部署步骤：

1. **注册PythonAnywhere**
   - 前往 https://www.pythonanywhere.com/
   - 注册免费账号

2. **上传代码**
   - 通过Files页面上传webmining文件夹
   - 或使用Git克隆仓库

3. **创建Web App**
   - 进入Web页面
   - 点击 "Add a new web app"
   - 选择Flask框架
   - 设置Python版本为3.9+

4. **配置WSGI文件**
   ```python
   import sys
   import os
   
   # 添加项目路径
   path = '/home/yourusername/webmining'
   if path not in sys.path:
       sys.path.insert(0, path)
   
   from app import app as application
   ```

5. **安装依赖**
   ```bash
   pip3.9 install --user -r requirements.txt
   ```

### 选项5：Vercel

**优点：** 快速部署、全球CDN、免费SSL
**缺点：** 更适合静态站点，Python支持有限

#### 部署步骤：

1. **安装Vercel CLI**
   ```bash
   npm install -g vercel
   ```

2. **配置vercel.json**
   ```json
   {
     "builds": [
       {
         "src": "app.py",
         "use": "@vercel/python"
       }
     ],
     "routes": [
       {
         "src": "/(.*)",
         "dest": "app.py"
       }
     ]
   }
   ```

3. **部署**
   ```bash
   cd webmining
   vercel
   ```

## 🔧 部署后配置

### 1. 数据库初始化
首次部署后，应用会自动创建数据库表。

### 2. 域名配置
- Heroku: 应用会获得 `your-app-name.herokuapp.com` 域名
- Railway: 自动生成域名
- Render: 获得 `your-app-name.onrender.com` 域名

### 3. 监控和日志
- 使用各平台的日志功能监控应用状态
- 设置健康检查（应用已包含 `/health` 端点）

## 📝 注意事项

1. **数据文件**：确保 `BGG_Data.csv` 文件包含在部署中
2. **静态文件**：CSS和JS文件需要正确部署
3. **数据库**：SQLite文件会在部署时重置，考虑使用PostgreSQL进行持久化存储
4. **性能**：免费计划可能有性能限制，考虑升级到付费计划

## 🔒 安全建议

1. **密钥管理**：不要在代码中硬编码密钥
2. **HTTPS**：所有推荐的平台都提供免费SSL
3. **环境变量**：敏感信息通过环境变量配置
4. **访问控制**：应用包含用户认证系统

## 🆘 故障排除

### 常见问题：

1. **应用无法启动**
   - 检查requirements.txt是否完整
   - 确认Python版本兼容性
   - 查看部署日志

2. **数据加载失败**
   - 确认BGG_Data.csv文件存在
   - 检查文件路径配置
   - 查看应用日志

3. **静态文件404**
   - 确认static文件夹结构正确
   - 检查路径配置

## 📞 技术支持

如果遇到部署问题，请：
1. 检查应用日志
2. 确认所有文件都正确上传
3. 验证环境变量配置
4. 查看各平台的官方文档

---

**推荐部署流程：**
1. 首选Heroku（最成熟稳定）
2. 备选Railway（性能更好）
3. 考虑Render（如需更多自定义）

祝您部署成功！🎉 